var url='https://developers.zomato.com/api/v2.1/geocode';var zheader={Accept:"text/plain; charset=utf-8","Content-Type":"text/plain; charset=utf-8","X-Zomato-API-Key":"8f5fdf73b11bd2193e50f693ac5dbb9c"};var loc='';$('#locate').on('click',function(){navigator.geolocation.getCurrentPosition(function(position){var lat=position.coords.latitude;var lon=position.coords.longitude;$.ajax({type:'GET',url:url,headers:zheader,data:{lat:lat,lon:lon,}}).done(function(data){loc=data.location.title;$('#location').val(loc);showMap(data,lat,lon)})})});$('#check-res').on('click',function(){loc=$('#location').val();var urlLoc='https://developers.zomato.com/api/v2.1/locations';var lat='';var lon='';$.ajax({type:'GET',url:urlLoc,headers:zheader,data:{query:loc,}}).done(function(data){if(data.status=='success'){if(data.location_suggestions[0]){lat=data.location_suggestions[0].latitude;lon=data.location_suggestions[0].longitude;$.ajax({type:'GET',url:url,headers:zheader,data:{lat:lat,lon:lon,}}).done(function(data){showMap(data,lat,lon)})}else{$('#map').text("Entered location not available. Please try a different location.")}}})});function showMap(data,lat,lon){var locations=[];for(i=0;i<data.nearby_restaurants.length;i++){console.log(data.nearby_restaurants[i].restaurant.name);var arr=[];arr.push(data.nearby_restaurants[i].restaurant.name);arr.push(data.nearby_restaurants[i].restaurant.location.latitude);arr.push(data.nearby_restaurants[i].restaurant.location.longitude);arr.push(data.nearby_restaurants[i].restaurant.cuisines);arr.push(data.nearby_restaurants[i].restaurant.average_cost_for_two);arr.push(data.nearby_restaurants[i].restaurant.user_rating.aggregate_rating);arr.push(data.nearby_restaurants[i].restaurant.photos_url);arr.push(data.nearby_restaurants[i].restaurant.has_online_delivery);arr.push(data.nearby_restaurants[i].restaurant.book_url);arr.push(i+1);locations[i]=arr}
var map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:new google.maps.LatLng(lat,lon),mapTypeId:google.maps.MapTypeId.ROADMAP});var infowindow=new google.maps.InfoWindow();var marker,i;for(i=0;i<locations.length;i++){marker=new google.maps.Marker({position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map});google.maps.event.addListener(marker,'click',(function(marker,i){return function(){var con='<b>'+locations[i][0]+'</b>'+'<br/><div>Cuisines: '+locations[i][3]+'<br/>Cost for two: '+locations[i][4]+'<br/>Rating: '+locations[i][5]+'<br/>Photos: <a target="_blank" href="'+locations[i][6]+'">click here</a>';if(locations[i][7]==1){con+='<br/>Online Delivery: Yes'}else{con+='<br/>Online Delivery: No'}
console.log(locations[i][8]);if(locations[i][8]){con+='</br>Booking URL: <a target="_blank" href="'+locations[i][8]+'">book now</a>'}
infowindow.setContent(con);infowindow.open(map,marker)}})(marker,i))}}